"use strict";import Fader from"./FadeStuff.js";import BCScan from"./BCScan.js";export default class EventHandler{constructor(){this.fader=new Fader,this.doFindSubmit=function(e,t){self.handleAssetFindSubmit(e,t)},this.handleAssetEntryBtn(),this.handleAssetFind(),this.handleAssetList(),this.handleSplashScanBtn(),this.handleTitleCheckBoxes(),this.handleDone(),this.handleAssetSubmit()}handleAssetEntryBtn(){document.getElementById("assetEntryBtn").addEventListener("click",e=>{e.stopImmediatePropagation(),EventHandler.setDivDisplay(["assetEntryDiv","doneDiv"]),EventHandler.enableDisableInputs(["assetTag"]),this.handleEnterAssetTag()})}handleAssetFind(){self=this,document.getElementById("assetFindBtn").addEventListener("click",e=>{e.stopImmediatePropagation();let t=["findAssetModel","findAssetMaker"];for(let e of t){document.getElementById(e).options.length=0;let t=document.createElement("option");t.text="CHOOSE",t.value="CHOOSE",document.getElementById(e).appendChild(t)}this.populateAssetData(4,e=>{for(let t=0;t<e.length;t++){let s=document.createElement("option");s.text=e[t][0],s.value=e[t][0],document.getElementById("findAssetMaker").appendChild(s)}}),this.populateAssetData(5,e=>{for(let t=1;t<e.length;t++)for(let s=1;s<e[t].length;s++){let n=document.createElement("option");n.text=e[t][s],n.value=e[t][s],document.getElementById("findAssetModel").appendChild(n)}}),EventHandler.setDivDisplay(["assetFindDiv","doneDiv"]),EventHandler.enableDisableInputs(["findAssetMaker","findAssetModel","findAssetTag","findAssetLocation"]);let s=null,n=function(e){self.handleAssetFindSubmit(e,s)};document.getElementById("findAssetMaker").addEventListener("change",e=>{e.stopImmediatePropagation();let t=document.getElementById("findAssetMaker"),n=t.options[t.selectedIndex].value;"CHOOSE"!==n?(s=n,this.doFindSubmit("maker",s)):s=null}),document.getElementById("findAssetModel").addEventListener("change",e=>{e.stopImmediatePropagation();let t=document.getElementById("findAssetModel"),a=t.options[t.selectedIndex].value;"CHOOSE"!==a?(s=a,n("model")):s=null}),document.getElementById("findAssetTag").addEventListener("change",e=>{e.stopImmediatePropagation(),document.getElementById("findAssetTag").value?(s=document.getElementById("findAssetTag").value,n("tag")):s=null}),document.getElementById("findAssetLocation").addEventListener("change",e=>{e.stopImmediatePropagation(),document.getElementById("findAssetLocation").value?(s=document.getElementById("findAssetLocation").value,n("location")):s=null})})}handleAssetFindSubmit(e,t,s){let n=`${e},${t}`,a=this;document.getElementById("assetFindForm").reset(),EventHandler.setDivDisplay(["assetListDiv","assetListDivResults","doneDiv"]),fetch(document.url,{method:"POST",body:n,headers:{"x-requested-with":"fetch.3",mode:"no-cors"}}).then(e=>e.json()).then(e=>{if(e.length>0)a.listAssets(e);else if(s){EventHandler.setDivDisplay(["assetEntryDiv","doneDiv"]),EventHandler.enableDisableInputs(["assetTag","assetMaker"]),document.getElementById("assetTag").value=t;let e=new Event("change");document.getElementById("assetTag").dispatchEvent(e)}else document.getElementById("assetListDivResults").innerHTML="<br><br><h1>Asset does not exist in inventory.</h1>"}).catch(e=>{console.log(e)})}handleAssetList(){let e=this;document.getElementById("assetListBtn").addEventListener("click",t=>{t.stopImmediatePropagation(),EventHandler.setDivDisplay(["assetListDiv","assetListDivResults","doneDiv"]),fetch(document.url,{method:"POST",headers:{"x-requested-with":"fetch.1",mode:"no-cors"}}).then(function(e){return e.json()}).then(function(t){t.length>0?e.listAssets(t):document.getElementById("assetListDivResults").innerHTML="<br><br><h1>Asset does not exist in inventory.</h1>"}).catch(function(e){console.log(e)})})}listAssets(e){for(let t=0;t<e.length;t++){let s=document.createElement("div");s.setAttribute("class","grid-x"),s.setAttribute("id",`listAsset.${t}`),t%2==0&&(s.style.backgroundColor="gray"),document.getElementById("assetListDivResults").appendChild(s),s.addEventListener("click",e=>{e.stopImmediatePropagation();let t=e.currentTarget.id.slice(10);this.handleAssetEdit(t)});for(let n=0;n<e[0].length;n++){let a=document.createElement("div");0===n?(a.setAttribute("id",`tag.${t}`),a.setAttribute("class","cell small-2 large-2")):1===n?a.setAttribute("class","cell small-3 large-3"):2===n?a.setAttribute("class","cell small-3 large-3"):a.setAttribute("class","cell small-4 large-4"),a.innerText=e[t][n],s.appendChild(a)}}}handleSplashScanBtn(){let e=0,t=this;document.getElementById("splashScanBtn").addEventListener("click",s=>{s.stopImmediatePropagation(),EventHandler.setDivDisplay(["splashDiv","scannerContainer"]),BCScan.startBCScanner(s=>{e++,console.log(e),t.handleAssetFindSubmit("tag",s,!0)})})}handleEnterAssetTag(){document.getElementById("assetLocation").value="";document.getElementById("assetTag").addEventListener("change",e=>{e.stopImmediatePropagation();let t=Number(document.getElementById("assetTag").value);t>0&&t<99999999?fetch(document.url,{method:"POST",body:t,headers:{"x-requested-with":"fetch.6",mode:"no-cors"}}).then(e=>e.json()).then(e=>{e?(alert("Tag number exists, please re-enter."),document.getElementById("assetMaker").disabled=!0,document.getElementById("assetTag").value=""):(EventHandler.enableDisableInputs(["assetTag","assetMaker"]),this.handleAssetMaker())}).catch(e=>{console.log(e)}):(alert("Invalid number, please re-enter."),document.getElementById("assetMaker").disabled=!0,document.getElementById("assetTag").value="")})}handleAssetMaker(e){document.getElementById("assetMaker").options.length=0;let t=document.createElement("option");t.text="CHOOSE",t.value="CHOOSE",document.getElementById("assetMaker").appendChild(t),this.populateAssetData(4,t=>{for(let e=0;e<t.length;e++){let s=document.createElement("option");s.text=t[e][0],s.value=t[e][0],document.getElementById("assetMaker").appendChild(s)}if(e){document.getElementById("assetMaker").value=e.maker;let s=e.maker;this.handleAssetType(t,s,e),EventHandler.enableDisableInputs(["assetTag","assetMaker","assetType","serialNumber","assetModel","assetDescription","assetLocation","purchaseDate","assetWarranty","bad","title1","title9","31a","assetSubmit"])}else document.getElementById("assetLocation").value="",EventHandler.enableDisableInputs(["assetTag","assetMaker","assetType"]);document.getElementById("assetMaker").addEventListener("change",e=>{e.stopImmediatePropagation();let s=document.getElementById("assetMaker"),n=s.options[s.selectedIndex].value;this.handleAssetType(t,n,null)})})}handleAssetType(e,t,s){document.getElementById("assetType").options.length=0;let n=document.createElement("option");n.text="CHOOSE",n.value="CHOOSE",document.getElementById("assetType").appendChild(n);for(let s=0;s<e.length;s++)if(e[s][0]===t){for(let t=1;t<e[s].length;t++){let n=document.createElement("option");n.text=e[s][t],n.value=e[s][t],document.getElementById("assetType").appendChild(n)}break}if(s){document.getElementById("assetType").value=s.type;let e=s.type;this.handleAssetModel(e,s)}else document.getElementById("assetLocation").value="",EventHandler.enableDisableInputs(["assetTag","assetMaker","assetType","serialNumber","assetModel"]);document.getElementById("assetType").addEventListener("change",e=>{e.stopImmediatePropagation();let t=document.getElementById("assetType"),s=t.options[t.selectedIndex].value;this.handleAssetModel(s,null)})}handleAssetModel(e,t){document.getElementById("assetModel").options.length=0;let s=document.createElement("option");s.text="CHOOSE",s.value="CHOOSE",document.getElementById("assetModel").appendChild(s),this.populateAssetData(5,s=>{for(let t=0;t<s.length;t++)if(s[t][0]===e){for(let e=1;e<s[t].length;e++){let n=document.createElement("option");n.text=s[t][e],n.value=s[t][e],document.getElementById("assetModel").appendChild(n)}break}t?document.getElementById("assetModel").value=t.model:(document.getElementById("assetLocation").value="",EventHandler.enableDisableInputs(["assetTag","assetMaker","assetType","serialNumber","assetModel","assetLocation"])),this.handleEnterLocation()})}handleEnterLocation(){document.getElementById("assetLocation").addEventListener("change",e=>{e.stopImmediatePropagation(),/[0-9][0-9][0-9][clwshmxftz]/i.test(document.getElementById("assetLocation").value)?(EventHandler.setDivDisplay(["assetEntryDiv","doneDiv","assetTag","assetMaker","assetType","serialNumber","assetModel","assetDescription","assetLocation","purchaseDate","assetWarranty"]),EventHandler.enableDisableInputs(["assetTag","assetMaker","assetType","serialNumber","assetModel","assetLocation","assetDescription","bad","title1","title9","31a","assetSubmit","purchaseDate","assetWarranty"]),this.handleAssetSubmit()):(alert("Incorrect location entered. Please try again Ding Dong!"),document.getElementById("assetLocation").value="")})}handleTitleCheckBoxes(){let e=this;this.bad=0,this.title1=0,this.title9=0,this.thirtyOneA=0;let t=document.getElementsByName("titleCheckBox");for(let s=0;s<t.length;s++){t[s].addEventListener("click",t=>{t.stopImmediatePropagation(),!0===document.getElementById("bad").checked?e.bad=1:e.bad=0,!0===document.getElementById("title1").checked?e.title1=1:e.title1=0,!0===document.getElementById("title9").checked?e.title9=1:e.title9=0,!0===document.getElementById("31a").checked?e.thirtyOneA=1:e.thirtyOneA=0})}}handleDone(){document.getElementById("doneBtn").addEventListener("click",e=>{e.stopImmediatePropagation(),document.getElementById("assetListDivResults").innerHTML="",document.getElementById("assetEntryForm").reset(),document.getElementById("assetFindForm").reset(),EventHandler.setDivDisplay(["splashDiv","splashScanDiv"]),EventHandler.enableDisableInputs(["assetEntryBtn","assetFindBtn","assetListBtn","installBtn","splashScanBtn"]),EventHandler.setDivDisplay(["splashDiv","splashScanDiv"])})}handleAssetEdit(e){let t=`tag.${e}`,s=document.getElementById(t).innerText;fetch(document.url,{method:"POST",body:s,headers:{"x-requested-with":"fetch.7",mode:"no-cors"}}).then(e=>e.json()).then(e=>{EventHandler.setDivDisplay(["assetEntryDiv","doneDiv"]),EventHandler.enableDisableInputs(["assetTag","assetMaker","assetType","serialNumber","assetModel","assetDescription","assetLocation","purchaseDate","assetWarranty","bad","title1","title9","31a","assetSubmit"]),document.getElementById("assetTag").value=e.tag,document.getElementById("assetLocation").value=e.location,document.getElementById("serialNumber").value=e.sn,document.getElementById("assetDescription").value=e.description,document.getElementById("purchaseDate").value=e.purchaseDate,document.getElementById("assetWarranty").value=e.warranty,1===Number(e.bad)&&(document.getElementById("bad").checked=!0),1===Number(e.isTitle1)&&(document.getElementById("title1").checked=!0),1===Number(e.isTitle9)&&(document.getElementById("title9").checked=!0),1===Number(e.is31a)&&(document.getElementById("31a").checked=!0),this.handleAssetMaker(e)}).catch(e=>{console.log(e)})}sendFormData(){let e=new FormData;e.append("tag",document.getElementById("assetTag").value),e.append("maker",document.getElementById("assetMaker").value),e.append("model",document.getElementById("assetModel").value),e.append("sn",document.getElementById("serialNumber").value),e.append("type",document.getElementById("assetType").value),e.append("description",document.getElementById("assetDescription").value),e.append("warranty",document.getElementById("assetWarranty").value),e.append("purchaseDate",document.getElementById("purchaseDate").value),e.append("location",document.getElementById("assetLocation").value),e.append("isBad",this.bad),e.append("isTitle1",this.title1),e.append("isTitle9",this.title9),e.append("is31a",this.thirtyOneA),fetch(document.url,{method:"POST",body:e,headers:{"x-requested-with":"fetch.0",mode:"no-cors"}}).then(e=>(console.log(e.text()),e.json())).catch(e=>{console.log(e)}),document.getElementById("assetEntryForm").reset()}handleAssetSubmit(){document.getElementById("assetSubmit").addEventListener("click",e=>{e.stopImmediatePropagation(),document.forms.assetEntryForm.checkValidity()?(this.sendFormData(),document.getElementById("happyFace").style.display="none",this.fader.doFade("in","entryResult"),setTimeout(()=>{document.getElementById("entryResult").style.display="none",this.fader.doFade("in","happyFace")},2e3),EventHandler.enableDisableInputs(["assetTag"])):document.forms.assetEntryForm.reportValidity()})}populateAssetData(e,t){fetch(document.url,{method:"POST",body:null,headers:{"x-requested-with":`fetch.${e}`,mode:"no-cors"}}).then(e=>e.json()).then(e=>{t(e)}).catch(e=>{console.log(e)})}static enableDisableInputs(e){const t=["assetTag","assetMaker","assetType","serialNumber","assetModel","assetDescription","assetLocation","purchaseDate","assetWarranty","bad","title1","title9","31a","assetSubmit","findAssetMaker","findAssetModel","findAssetTag","findAssetLocation","assetEntryBtn","assetFindBtn","assetListBtn","installBtn","splashScanBtn"];for(let e of t)document.getElementById(e).disabled=!0;for(let t of e)document.getElementById(t).disabled=!1}static setDivDisplay(e){const t=["splashDiv","splashScanDiv","assetEntryDiv","assetListDiv","assetListDivResults","scanResultsExistsDiv","scanResultsNotExistDiv","assetFindDiv","doneDiv","entryResult","installBanner","scannerContainer"];for(let e of t)document.getElementById(e)&&(document.getElementById(e).style.display="none");for(let t of e)document.getElementById(t).style.display="block"}}